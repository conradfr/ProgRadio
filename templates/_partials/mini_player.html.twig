<script type="module">
{% verbatim %}
(()=>{"use strict";function e(t){if(h(t)){const s={};for(let i=0;i<t.length;i++){const o=t[i],r=e(f(o)?n(o):o);if(r)for(const e in r)s[e]=r[e]}return s}if(g(t))return t}const t=/;(?![^(]*\))/g,s=/:(.+)/;function n(e){const n={};return e.split(t).forEach((e=>{if(e){const t=e.split(s);t.length>1&&(n[t[0].trim()]=t[1].trim())}})),n}function i(e){let t="";if(f(e))t=e;else if(h(e))for(let s=0;s<e.length;s++){const n=i(e[s]);n&&(t+=n+" ")}else if(g(e))for(const s in e)e[s]&&(t+=s+" ");return t.trim()}function o(e,t){if(e===t)return!0;let s=d(e),n=d(t);if(s||n)return!(!s||!n)&&e.getTime()===t.getTime();if(s=h(e),n=h(t),s||n)return!(!s||!n)&&function(e,t){if(e.length!==t.length)return!1;let s=!0;for(let n=0;s&&n<e.length;n++)s=o(e[n],t[n]);return s}(e,t);if(s=g(e),n=g(t),s||n){if(!s||!n)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e){const n=e.hasOwnProperty(s),i=t.hasOwnProperty(s);if(n&&!i||!n&&i||!o(e[s],t[s]))return!1}}return String(e)===String(t)}function r(e,t){return e.findIndex((e=>o(e,t)))}const l={},a=Object.prototype.hasOwnProperty,c=(e,t)=>a.call(e,t),h=Array.isArray,u=e=>"[object Map]"===v(e),d=e=>e instanceof Date,f=e=>"string"==typeof e,p=e=>"symbol"==typeof e,g=e=>null!==e&&"object"==typeof e,m=Object.prototype.toString,v=e=>m.call(e),y=e=>f(e)&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,b=e=>{const t=Object.create(null);return s=>t[s]||(t[s]=e(s))},w=/-(\w)/g,k=b((e=>e.replace(w,((e,t)=>t?t.toUpperCase():"")))),E=/\B([A-Z])/g,C=b((e=>e.replace(E,"-$1").toLowerCase())),R=e=>{const t=parseFloat(e);return isNaN(t)?e:t},S=new WeakMap,T=[];let _;const j=Symbol(""),$=Symbol("");function x(e){e.active&&(O(e),e.options.onStop&&e.options.onStop(),e.active=!1)}let A=0;function O(e){const{deps:t}=e;if(t.length){for(let s=0;s<t.length;s++)t[s].delete(e);t.length=0}}let L=!0;const P=[];function I(){const e=P.pop();L=void 0===e||e}function N(e,t,s){if(!L||void 0===_)return;let n=S.get(e);n||S.set(e,n=new Map);let i=n.get(s);i||n.set(s,i=new Set),i.has(_)||(i.add(_),_.deps.push(i))}function H(e,t,s,n,i,o){const r=S.get(e);if(!r)return;const l=new Set,a=e=>{e&&e.forEach((e=>{(e!==_||e.allowRecurse)&&l.add(e)}))};if("clear"===t)r.forEach(a);else if("length"===s&&h(e))r.forEach(((e,t)=>{("length"===t||t>=n)&&a(e)}));else switch(void 0!==s&&a(r.get(s)),t){case"add":h(e)?y(s)&&a(r.get("length")):(a(r.get(j)),u(e)&&a(r.get($)));break;case"delete":h(e)||(a(r.get(j)),u(e)&&a(r.get($)));break;case"set":u(e)&&a(r.get(j))}l.forEach((e=>{e.options.scheduler?e.options.scheduler(e):e()}))}const M=function(e,t){const s=Object.create(null),n=e.split(",");for(let e=0;e<n.length;e++)s[n[e]]=!0;return t?e=>!!s[e.toLowerCase()]:e=>!!s[e]}("__proto__,__v_isRef,__isVue"),U=new Set(Object.getOwnPropertyNames(Symbol).map((e=>Symbol[e])).filter(p)),D=q(),B=q(!0),J=function(){const e={};return["includes","indexOf","lastIndexOf"].forEach((t=>{const s=Array.prototype[t];e[t]=function(...e){const t=Q(this);for(let e=0,s=this.length;e<s;e++)N(t,0,e+"");const n=s.apply(t,e);return-1===n||!1===n?s.apply(t,e.map(Q)):n}})),["push","pop","shift","unshift","splice"].forEach((t=>{const s=Array.prototype[t];e[t]=function(...e){P.push(L),L=!1;const t=s.apply(this,e);return I(),t}})),e}();function q(e=!1,t=!1){return function(s,n,i){if("__v_isReactive"===n)return!e;if("__v_isReadonly"===n)return e;if("__v_raw"===n&&i===(e?t?V:z:t?K:F).get(s))return s;const o=h(s);if(!e&&o&&c(J,n))return Reflect.get(J,n,i);const r=Reflect.get(s,n,i);return(p(n)?U.has(n):M(n))?r:(e||N(s,0,n),t?r:Y(r)?o&&y(n)?r:r.value:g(r)?e?function(e){return X(e,!0,G,null,z)}(r):Z(r):r)}}const W={get:D,set:function(e=!1){return function(t,s,n,i){let o=t[s];if(!e&&(n=Q(n),o=Q(o),!h(t)&&Y(o)&&!Y(n)))return o.value=n,!0;const r=h(t)&&y(s)?Number(s)<t.length:c(t,s),l=Reflect.set(t,s,n,i);return t===Q(i)&&(r?((e,t)=>e!==t&&(e==e||t==t))(n,o)&&H(t,"set",s,n):H(t,"add",s,n)),l}}(),deleteProperty:function(e,t){const s=c(e,t);e[t];const n=Reflect.deleteProperty(e,t);return n&&s&&H(e,"delete",t,void 0),n},has:function(e,t){const s=Reflect.has(e,t);return p(t)&&U.has(t)||N(e,0,t),s},ownKeys:function(e){return N(e,0,h(e)?"length":j),Reflect.ownKeys(e)}},G={get:B,set:(e,t)=>!0,deleteProperty:(e,t)=>!0},F=new WeakMap,K=new WeakMap,z=new WeakMap,V=new WeakMap;function Z(e){return e&&e.__v_isReadonly?e:X(e,!1,W,null,F)}function X(e,t,s,n,i){if(!g(e))return e;if(e.__v_raw&&(!t||!e.__v_isReactive))return e;const o=i.get(e);if(o)return o;const r=function(e){return e.__v_skip||!Object.isExtensible(e)?0:function(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}((e=>v(e).slice(8,-1))(e))}(e);if(0===r)return e;const l=new Proxy(e,2===r?n:s);return i.set(e,l),l}function Q(e){return e&&Q(e.__v_raw)||e}function Y(e){return Boolean(e&&!0===e.__v_isRef)}let ee=!1;const te=[],se=Promise.resolve(),ne=e=>se.then(e),ie=e=>{te.includes(e)||te.push(e),ee||(ee=!0,ne(oe))},oe=()=>{for(let e=0;e<te.length;e++)te[e]();te.length=0,ee=!1},re=/^(spellcheck|draggable|form|list|type)$/,le=({el:e,get:t,effect:s,arg:n,modifiers:i})=>{let o;"class"===n&&(e._class=e.className),s((()=>{let s=t();if(n)(null==i?void 0:i.camel)&&(n=k(n)),ae(e,n,s,o);else{for(const t in s)ae(e,t,s[t],o&&o[t]);for(const t in o)s&&t in s||ae(e,t,null)}o=s}))},ae=(t,s,n,o)=>{if("class"===s)t.setAttribute("class",i(t._class?[t._class,n]:n)||"");else if("style"===s){n=e(n);const{style:s}=t;if(n)if(f(n))n!==o&&(s.cssText=n);else{for(const e in n)he(s,e,n[e]);if(o&&!f(o))for(const e in o)null==n[e]&&he(s,e,"")}else t.removeAttribute("style")}else t instanceof SVGElement||!(s in t)||re.test(s)?"true-value"===s?t._trueValue=n:"false-value"===s?t._falseValue=n:null!=n?t.setAttribute(s,n):t.removeAttribute(s):(t[s]=n,"value"===s&&(t._value=n))},ce=/\s*!important$/,he=(e,t,s)=>{h(s)?s.forEach((s=>he(e,t,s))):t.startsWith("--")?e.setProperty(t,s):ce.test(s)?e.setProperty(C(t),s.replace(ce,""),"important"):e[t]=s},ue=(e,t)=>{const s=e.getAttribute(t);return null!=s&&e.removeAttribute(t),s},de=(e,t,s,n)=>{e.addEventListener(t,s,n)},fe=/^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['[^']*?']|\["[^"]*?"]|\[\d+]|\[[A-Za-z_$][\w$]*])*$/,pe=["ctrl","shift","alt","meta"],ge={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&0!==e.button,middle:e=>"button"in e&&1!==e.button,right:e=>"button"in e&&2!==e.button,exact:(e,t)=>pe.some((s=>e[`${s}Key`]&&!t[s]))},me=({el:e,get:t,exp:s,arg:n,modifiers:i})=>{if(!n)return;let o=fe.test(s)?t(`(e => ${s}(e))`):t(`($event => { ${s} })`);if("mounted"!==n){if("unmounted"===n)return()=>o();if(i){"click"===n&&(i.right&&(n="contextmenu"),i.middle&&(n="mouseup"));const e=o;o=t=>{if(!("key"in t)||C(t.key)in i){for(const e in i){const s=ge[e];if(s&&s(t,i))return}return e(t)}}}de(e,n,o,i)}else ne(o)},ve=({el:e,get:t,effect:s})=>{s((()=>{e.textContent=ye(t())}))},ye=e=>null==e?"":g(e)?JSON.stringify(e,null,2):String(e),be=e=>"_value"in e?e._value:e.value,we=(e,t)=>{const s=t?"_trueValue":"_falseValue";return s in e?e[s]:t},ke=e=>{e.target.composing=!0},Ee=e=>{const t=e.target;t.composing&&(t.composing=!1,Ce(t,"input"))},Ce=(e,t)=>{const s=document.createEvent("HTMLEvents");s.initEvent(t,!0,!0),e.dispatchEvent(s)},Re=Object.create(null),Se=(e,t,s)=>Te(e,`return(${t})`,s),Te=(e,t,s)=>{const n=Re[t]||(Re[t]=_e(t));try{return n(e,s)}catch(e){console.error(e)}},_e=e=>{try{return new Function("$data","$el",`with($data){${e}}`)}catch(t){return console.error(`${t.message} in expression: ${e}`),()=>{}}},je={bind:le,on:me,show:({el:e,get:t,effect:s})=>{const n=e.style.display;s((()=>{e.style.display=t()?n:"none"}))},text:ve,html:({el:e,get:t,effect:s})=>{s((()=>{e.innerHTML=t()}))},model:({el:e,exp:t,get:s,effect:n,modifiers:i})=>{const l=e.type,a=s(`(val) => { ${t} = val }`),{trim:c,number:u="number"===l}=i||{};if("SELECT"===e.tagName){const t=e;de(e,"change",(()=>{const e=Array.prototype.filter.call(t.options,(e=>e.selected)).map((e=>u?R(be(e)):be(e)));a(t.multiple?e:e[0])})),n((()=>{const e=s(),n=t.multiple;for(let s=0,i=t.options.length;s<i;s++){const i=t.options[s],l=be(i);if(n)h(e)?i.selected=r(e,l)>-1:i.selected=e.has(l);else if(o(be(i),e))return void(t.selectedIndex!==s&&(t.selectedIndex=s))}n||-1===t.selectedIndex||(t.selectedIndex=-1)}))}else if("checkbox"===l){let t;de(e,"change",(()=>{const t=s(),n=e.checked;if(h(t)){const s=be(e),i=r(t,s),o=-1!==i;if(n&&!o)a(t.concat(s));else if(!n&&o){const e=[...t];e.splice(i,1),a(e)}}else a(we(e,n))})),n((()=>{const n=s();h(n)?e.checked=r(n,be(e))>-1:n!==t&&(e.checked=o(n,we(e,!0))),t=n}))}else if("radio"===l){let t;de(e,"change",(()=>{a(be(e))})),n((()=>{const n=s();n!==t&&(e.checked=o(n,be(e)))}))}else{const t=e=>c?e.trim():u?R(e):e;de(e,"compositionstart",ke),de(e,"compositionend",Ee),de(e,(null==i?void 0:i.lazy)?"change":"input",(()=>{e.composing||a(t(e.value))})),c&&de(e,"change",(()=>{e.value=e.value.trim()})),n((()=>{if(e.composing)return;const n=e.value,i=s();document.activeElement===e&&t(n)===i||n!==i&&(e.value=i)}))}},effect:({el:e,ctx:t,exp:s,effect:n})=>{ne((()=>n((()=>Te(t.scope,s,e)))))}},$e=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,xe=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,Ae=/^\(|\)$/g,Oe=/^[{[]\s*((?:[\w_$]+\s*,?\s*)+)[\]}]$/,Le=({el:e,ctx:{scope:{$refs:t}},get:s,effect:n})=>{let i;return n((()=>{const n=s();t[n]=e,i&&n!==i&&delete t[i],i=n})),()=>{i&&delete t[i]}},Pe=/^(?:v-|:|@)/,Ie=/\.([\w-]+)/g,Ne=/\{\{([^]+?)\}\}/g;let He=!1;const Me=(e,t)=>{const s=e.nodeType;if(1===s){const s=e;if(s.hasAttribute("v-pre"))return;let n;if(n=ue(s,"v-if"))return((e,t,s)=>{const n=e.parentElement,i=new Comment("v-if");n.insertBefore(i,e);const o=[{exp:t,el:e}];let r,l;for(;(r=e.nextElementSibling)&&(l=null,""===ue(r,"v-else")||(l=ue(r,"v-else-if")));)n.removeChild(r),o.push({exp:l,el:r});const a=e.nextSibling;let c;n.removeChild(e);let h=-1;const u=()=>{c&&(n.insertBefore(i,c.el),c.remove(),c=void 0)};return s.effect((()=>{for(let e=0;e<o.length;e++){const{exp:t,el:r}=o[e];if(!t||Se(s.scope,t))return void(e!==h&&(u(),c=new Ge(r,s),c.insert(n,i),n.removeChild(i),h=e))}h=-1,u()})),a})(s,n,t);if(n=ue(s,"v-for"))return((e,t,s)=>{const n=t.match($e);if(!n)return;const i=e.nextSibling,o=e.parentElement,r=new Text("");o.insertBefore(r,e),o.removeChild(e);const l=n[2].trim();let a,c,u,d,f=n[1].trim().replace(Ae,"").trim(),p=!1,m="key",v=e.getAttribute(m)||e.getAttribute(m=":key")||e.getAttribute(m="v-bind:key");v&&(e.removeAttribute(m),"key"===m&&(v=JSON.stringify(v))),(d=f.match(xe))&&(f=f.replace(xe,"").trim(),c=d[1].trim(),d[2]&&(u=d[2].trim())),(d=f.match(Oe))&&(a=d[1].split(",").map((e=>e.trim())),p="["===f[0]);let y,b,w,k=!1;const E=(e,t,n,i)=>{const o={};a?a.forEach(((e,s)=>o[e]=t[p?s:e])):o[f]=t,i?(c&&(o[c]=i),u&&(o[u]=n)):c&&(o[c]=n);const r=We(s,o),l=v?Se(r.scope,v):n;return e.set(l,n),r.key=l,r},C=(t,s)=>{const n=new Ge(e,t);return n.key=t.key,n.insert(o,s),n};return s.effect((()=>{const e=Se(s.scope,l),t=w;if([b,w]=(e=>{const t=new Map,s=[];if(h(e))for(let n=0;n<e.length;n++)s.push(E(t,e[n],n));else if("number"==typeof e)for(let n=0;n<e;n++)s.push(E(t,n+1,n));else if(g(e)){let n=0;for(const i in e)s.push(E(t,e[i],n++,i))}return[s,t]})(e),k){const e=[];for(let e=0;e<y.length;e++)w.has(y[e].key)||y[e].remove();let s=b.length;for(;s--;){const n=b[s],i=t.get(n.key),l=b[s+1],a=l&&t.get(l.key),c=null==a?void 0:y[a];if(null==i)e[s]=C(n,c?c.el:r);else{const t=e[s]=y[i];Object.assign(t.ctx.scope,n.scope),i!==s&&y[i+1]!==c&&t.insert(o,c?c.el:r)}}y=e}else y=b.map((e=>C(e,r))),k=!0})),i})(s,n,t);if((n=ue(s,"v-scope"))||""===n){const e=n?Se(t.scope,n):{};t=We(t,e),e.$template&&Je(s,e.$template)}const i=null!=ue(s,"v-once");let o;i&&(He=!0),(n=ue(s,"ref"))&&Be(s,Le,`"${n}"`,t),Ue(s,t);for(const{name:e,value:n}of[...s.attributes])Pe.test(e)&&"v-cloak"!==e&&("v-model"===e?o=n:De(s,e,n,t));o&&De(s,"v-model",o,t),i&&(He=!1)}else if(3===s){const s=e.data;if(s.includes("{{")){let n,i=[],o=0;for(;n=Ne.exec(s);){const e=s.slice(o,n.index);e&&i.push(JSON.stringify(e)),i.push(`$s(${n[1]})`),o=n.index+n[0].length}o<s.length&&i.push(JSON.stringify(s.slice(o))),Be(e,ve,i.join("+"),t)}}else 11===s&&Ue(e,t)},Ue=(e,t)=>{let s=e.firstChild;for(;s;)s=Me(s,t)||s.nextSibling},De=(e,t,s,n)=>{let i,o,r,l=null;for(;l=Ie.exec(t);)(r||(r={}))[l[1]]=!0,t=t.slice(0,l.index);if(":"===t[0])i=le,o=t.slice(1);else if("@"===t[0])i=me,o=t.slice(1);else{const e=t.indexOf(":"),s=e>0?t.slice(2,e):t.slice(2);i=je[s]||n.dirs[s],o=e>0?t.slice(e+1):void 0}i&&(i===le&&"ref"===o&&(i=Le),Be(e,i,s,n,o,r),e.removeAttribute(t))},Be=(e,t,s,n,i,o)=>{const r=t({el:e,get:(t=s)=>Se(n.scope,t,e),effect:n.effect,ctx:n,exp:s,arg:i,modifiers:o});r&&n.cleanups.push(r)},Je=(e,t)=>{if("#"!==t[0])e.innerHTML=t;else{const s=document.querySelector(t);e.appendChild(s.content.cloneNode(!0))}},qe=e=>{const t={...e,scope:e?e.scope:Z({}),dirs:e?e.dirs:{},effects:[],blocks:[],cleanups:[],effect:e=>{if(He)return ie(e),e;const s=function(e,t=l){(function(e){return e&&!0===e._isEffect})(e)&&(e=e.raw);const s=function(e,t){const s=function(){if(!s.active)return e();if(!T.includes(s)){O(s);try{return P.push(L),L=!0,T.push(s),_=s,e()}finally{T.pop(),I(),_=T[T.length-1]}}};return s.id=A++,s.allowRecurse=!!t.allowRecurse,s._isEffect=!0,s.active=!0,s.raw=e,s.deps=[],s.options=t,s}(e,t);return t.lazy||s(),s}(e,{scheduler:()=>ie(s)});return t.effects.push(s),s}};return t},We=(e,t={})=>{const s=e.scope,n=Object.create(s);Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)),n.$refs=Object.create(s.$refs);const i=Z(new Proxy(n,{set:(e,t,n,o)=>o!==i||e.hasOwnProperty(t)?Reflect.set(e,t,n,o):Reflect.set(s,t,n)}));return{...e,scope:i}};class Ge{get el(){return this.start||this.template}constructor(e,t,s=!1){this.isFragment=e instanceof HTMLTemplateElement,s?this.template=e:this.isFragment?this.template=e.content.cloneNode(!0):this.template=e.cloneNode(!0),s?this.ctx=t:(this.parentCtx=t,t.blocks.push(this),this.ctx=qe(t)),Me(this.template,this.ctx)}insert(e,t=null){if(this.isFragment)if(this.start){let s,n=this.start;for(;n&&(s=n.nextSibling,e.insertBefore(n,t),n!==this.end);)n=s}else this.start=new Text(""),this.end=new Text(""),e.insertBefore(this.end,t),e.insertBefore(this.start,this.end),e.insertBefore(this.template,this.end);else e.insertBefore(this.template,t)}remove(){if(this.parentCtx&&((e,t)=>{const s=e.indexOf(t);s>-1&&e.splice(s,1)})(this.parentCtx.blocks,this),this.start){const e=this.start.parentNode;let t,s=this.start;for(;s&&(t=s.nextSibling,e.removeChild(s),s!==this.end);)s=t}else this.template.parentNode.removeChild(this.template);this.teardown()}teardown(){this.ctx.blocks.forEach((e=>{e.teardown()})),this.ctx.effects.forEach(x),this.ctx.cleanups.forEach((e=>e()))}}const Fe=e=>{const t=qe();let s;return e&&(t.scope=Z(e)),t.scope.$s=ye,t.scope.$nextTick=ne,t.scope.$refs=Object.create(null),{directive(e,s){return s?(t.dirs[e]=s,this):t.dirs[e]},mount(e){if("string"==typeof e&&!(e=document.querySelector(e)))return;let n;return n=(e=e||document.documentElement).hasAttribute("v-scope")?[e]:[...e.querySelectorAll("[v-scope]")].filter((e=>!e.matches("[v-scope] [v-scope]"))),n.length||(n=[e]),s=n.map((e=>new Ge(e,t,!0))),[e,...e.querySelectorAll("[v-cloak]")].forEach((e=>e.removeAttribute("v-cloak"))),this},unmount(){s.forEach((e=>e.teardown()))}}};let Ke;(Ke=document.currentScript)&&Ke.hasAttribute("init")&&Fe().mount();const ze="undefined"!=typeof self?self:null,Ve="undefined"!=typeof window?window:null,Ze=ze||Ve||void 0,Xe=0,Qe=1,Ye=2,et=3,tt="closed",st="errored",nt="joined",it="joining",ot="leaving",rt="phx_close",lt="phx_error",at="phx_join",ct="phx_reply",ht="phx_leave",ut=[rt,lt,at,ct,ht],dt="longpoll",ft="websocket";let pt=e=>{if("function"==typeof e)return e;return function(){return e}};class gt{constructor(e,t,s,n){this.channel=e,this.event=t,this.payload=s||function(){return{}},this.receivedResp=null,this.timeout=n,this.timeoutTimer=null,this.recHooks=[],this.sent=!1}resend(e){this.timeout=e,this.reset(),this.send()}send(){this.hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload(),ref:this.ref,join_ref:this.channel.joinRef()}))}receive(e,t){return this.hasReceived(e)&&t(this.receivedResp.response),this.recHooks.push({status:e,callback:t}),this}reset(){this.cancelRefEvent(),this.ref=null,this.refEvent=null,this.receivedResp=null,this.sent=!1}matchReceive({status:e,response:t,ref:s}){this.recHooks.filter((t=>t.status===e)).forEach((e=>e.callback(t)))}cancelRefEvent(){this.refEvent&&this.channel.off(this.refEvent)}cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=null}startTimeout(){this.timeoutTimer&&this.cancelTimeout(),this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref),this.channel.on(this.refEvent,(e=>{this.cancelRefEvent(),this.cancelTimeout(),this.receivedResp=e,this.matchReceive(e)})),this.timeoutTimer=setTimeout((()=>{this.trigger("timeout",{})}),this.timeout)}hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}trigger(e,t){this.channel.trigger(this.refEvent,{status:e,response:t})}}class mt{constructor(e,t,s){this.state=tt,this.topic=e,this.params=pt(t||{}),this.socket=s,this.bindings=[],this.bindingRef=0,this.timeout=this.socket.timeout,this.joinedOnce=!1,this.joinPush=new gt(this,at,this.params,this.timeout),this.pushBuffer=[],this.stateChangeRefs=[],this.rejoinTimer=new kt((()=>{this.socket.isConnected()&&this.rejoin()}),this.socket.rejoinAfterMs),this.stateChangeRefs.push(this.socket.onError((()=>this.rejoinTimer.reset()))),this.stateChangeRefs.push(this.socket.onOpen((()=>{this.rejoinTimer.reset(),this.isErrored()&&this.rejoin()}))),this.joinPush.receive("ok",(()=>{this.state=nt,this.rejoinTimer.reset(),this.pushBuffer.forEach((e=>e.send())),this.pushBuffer=[]})),this.joinPush.receive("error",(()=>{this.state=st,this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()})),this.onClose((()=>{this.rejoinTimer.reset(),this.socket.hasLogger()&&this.socket.log("channel",`close ${this.topic} ${this.joinRef()}`),this.state=tt,this.socket.remove(this)})),this.onError((e=>{this.socket.hasLogger()&&this.socket.log("channel",`error ${this.topic}`,e),this.isJoining()&&this.joinPush.reset(),this.state=st,this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()})),this.joinPush.receive("timeout",(()=>{this.socket.hasLogger()&&this.socket.log("channel",`timeout ${this.topic} (${this.joinRef()})`,this.joinPush.timeout),new gt(this,ht,pt({}),this.timeout).send(),this.state=st,this.joinPush.reset(),this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()})),this.on(ct,((e,t)=>{this.trigger(this.replyEventName(t),e)}))}join(e=this.timeout){if(this.joinedOnce)throw new Error("tried to join multiple times. 'join' can only be called a single time per channel instance");return this.timeout=e,this.joinedOnce=!0,this.rejoin(),this.joinPush}onClose(e){this.on(rt,e)}onError(e){return this.on(lt,(t=>e(t)))}on(e,t){let s=this.bindingRef++;return this.bindings.push({event:e,ref:s,callback:t}),s}off(e,t){this.bindings=this.bindings.filter((s=>!(s.event===e&&(void 0===t||t===s.ref))))}canPush(){return this.socket.isConnected()&&this.isJoined()}push(e,t,s=this.timeout){if(t=t||{},!this.joinedOnce)throw new Error(`tried to push '${e}' to '${this.topic}' before joining. Use channel.join() before pushing events`);let n=new gt(this,e,(function(){return t}),s);return this.canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}leave(e=this.timeout){this.rejoinTimer.reset(),this.joinPush.cancelTimeout(),this.state=ot;let t=()=>{this.socket.hasLogger()&&this.socket.log("channel",`leave ${this.topic}`),this.trigger(rt,"leave")},s=new gt(this,ht,pt({}),e);return s.receive("ok",(()=>t())).receive("timeout",(()=>t())),s.send(),this.canPush()||s.trigger("ok",{}),s}onMessage(e,t,s){return t}isLifecycleEvent(e){return ut.indexOf(e)>=0}isMember(e,t,s,n){return this.topic===e&&(!n||n===this.joinRef()||!this.isLifecycleEvent(t)||(this.socket.hasLogger()&&this.socket.log("channel","dropping outdated message",{topic:e,event:t,payload:s,joinRef:n}),!1))}joinRef(){return this.joinPush.ref}rejoin(e=this.timeout){this.isLeaving()||(this.socket.leaveOpenTopic(this.topic),this.state=it,this.joinPush.resend(e))}trigger(e,t,s,n){let i=this.onMessage(e,t,s,n);if(t&&!i)throw new Error("channel onMessage callbacks must return the payload, modified or unmodified");let o=this.bindings.filter((t=>t.event===e));for(let e=0;e<o.length;e++){o[e].callback(i,s,n||this.joinRef())}}replyEventName(e){return`chan_reply_${e}`}isClosed(){return this.state===tt}isErrored(){return this.state===st}isJoined(){return this.state===nt}isJoining(){return this.state===it}isLeaving(){return this.state===ot}}let vt={HEADER_LENGTH:1,META_LENGTH:4,KINDS:{push:0,reply:1,broadcast:2},encode(e,t){if(e.payload.constructor===ArrayBuffer)return t(this.binaryEncode(e));{let s=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(s))}},decode(e,t){if(e.constructor===ArrayBuffer)return t(this.binaryDecode(e));{let[s,n,i,o,r]=JSON.parse(e);return t({join_ref:s,ref:n,topic:i,event:o,payload:r})}},binaryEncode(e){let{join_ref:t,ref:s,event:n,topic:i,payload:o}=e,r=this.META_LENGTH+t.length+s.length+i.length+n.length,l=new ArrayBuffer(this.HEADER_LENGTH+r),a=new DataView(l),c=0;a.setUint8(c++,this.KINDS.push),a.setUint8(c++,t.length),a.setUint8(c++,s.length),a.setUint8(c++,i.length),a.setUint8(c++,n.length),Array.from(t,(e=>a.setUint8(c++,e.charCodeAt(0)))),Array.from(s,(e=>a.setUint8(c++,e.charCodeAt(0)))),Array.from(i,(e=>a.setUint8(c++,e.charCodeAt(0)))),Array.from(n,(e=>a.setUint8(c++,e.charCodeAt(0))));var h=new Uint8Array(l.byteLength+o.byteLength);return h.set(new Uint8Array(l),0),h.set(new Uint8Array(o),l.byteLength),h.buffer},binaryDecode(e){let t=new DataView(e),s=t.getUint8(0),n=new TextDecoder;switch(s){case this.KINDS.push:return this.decodePush(e,t,n);case this.KINDS.reply:return this.decodeReply(e,t,n);case this.KINDS.broadcast:return this.decodeBroadcast(e,t,n)}},decodePush(e,t,s){let n=t.getUint8(1),i=t.getUint8(2),o=t.getUint8(3),r=this.HEADER_LENGTH+this.META_LENGTH-1,l=s.decode(e.slice(r,r+n));r+=n;let a=s.decode(e.slice(r,r+i));r+=i;let c=s.decode(e.slice(r,r+o));return r+=o,{join_ref:l,ref:null,topic:a,event:c,payload:e.slice(r,e.byteLength)}},decodeReply(e,t,s){let n=t.getUint8(1),i=t.getUint8(2),o=t.getUint8(3),r=t.getUint8(4),l=this.HEADER_LENGTH+this.META_LENGTH,a=s.decode(e.slice(l,l+n));l+=n;let c=s.decode(e.slice(l,l+i));l+=i;let h=s.decode(e.slice(l,l+o));l+=o;let u=s.decode(e.slice(l,l+r));l+=r;let d=e.slice(l,e.byteLength);return{join_ref:a,ref:c,topic:h,event:ct,payload:{status:u,response:d}}},decodeBroadcast(e,t,s){let n=t.getUint8(1),i=t.getUint8(2),o=this.HEADER_LENGTH+2,r=s.decode(e.slice(o,o+n));o+=n;let l=s.decode(e.slice(o,o+i));return o+=i,{join_ref:null,ref:null,topic:r,event:l,payload:e.slice(o,e.byteLength)}}};class yt{constructor(e,t={}){this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.channels=[],this.sendBuffer=[],this.ref=0,this.timeout=t.timeout||1e4,this.transport=t.transport||Ze.WebSocket||bt,this.defaultEncoder=vt.encode.bind(vt),this.defaultDecoder=vt.decode.bind(vt),this.closeWasClean=!1,this.unloaded=!1,this.binaryType=t.binaryType||"arraybuffer",this.transport!==bt?(this.encode=t.encode||this.defaultEncoder,this.decode=t.decode||this.defaultDecoder):(this.encode=this.defaultEncoder,this.decode=this.defaultDecoder),Ve&&Ve.addEventListener&&Ve.addEventListener("beforeunload",(e=>{this.conn&&(this.unloaded=!0,this.abnormalClose("unloaded"))})),this.heartbeatIntervalMs=t.heartbeatIntervalMs||3e4,this.rejoinAfterMs=e=>t.rejoinAfterMs?t.rejoinAfterMs(e):[1e3,2e3,5e3][e-1]||1e4,this.reconnectAfterMs=e=>this.unloaded?100:t.reconnectAfterMs?t.reconnectAfterMs(e):[10,50,100,150,200,250,500,1e3,2e3][e-1]||5e3,this.logger=t.logger||null,this.longpollerTimeout=t.longpollerTimeout||2e4,this.params=pt(t.params||{}),this.endPoint=`${e}/${ft}`,this.vsn=t.vsn||"2.0.0",this.heartbeatTimer=null,this.pendingHeartbeatRef=null,this.reconnectTimer=new kt((()=>{this.teardown((()=>this.connect()))}),this.reconnectAfterMs)}protocol(){return location.protocol.match(/^https/)?"wss":"ws"}endPointURL(){let e=wt.appendParams(wt.appendParams(this.endPoint,this.params()),{vsn:this.vsn});return"/"!==e.charAt(0)?e:"/"===e.charAt(1)?`${this.protocol()}:${e}`:`${this.protocol()}://${location.host}${e}`}disconnect(e,t,s){this.closeWasClean=!0,this.reconnectTimer.reset(),this.teardown(e,t,s)}connect(e){e&&(console&&console.log("passing params to connect is deprecated. Instead pass :params to the Socket constructor"),this.params=pt(e)),this.conn||(this.closeWasClean=!1,this.conn=new this.transport(this.endPointURL()),this.conn.binaryType=this.binaryType,this.conn.timeout=this.longpollerTimeout,this.conn.onopen=()=>this.onConnOpen(),this.conn.onerror=e=>this.onConnError(e),this.conn.onmessage=e=>this.onConnMessage(e),this.conn.onclose=e=>this.onConnClose(e))}log(e,t,s){this.logger(e,t,s)}hasLogger(){return null!==this.logger}onOpen(e){let t=this.makeRef();return this.stateChangeCallbacks.open.push([t,e]),t}onClose(e){let t=this.makeRef();return this.stateChangeCallbacks.close.push([t,e]),t}onError(e){let t=this.makeRef();return this.stateChangeCallbacks.error.push([t,e]),t}onMessage(e){let t=this.makeRef();return this.stateChangeCallbacks.message.push([t,e]),t}onConnOpen(){this.hasLogger()&&this.log("transport",`connected to ${this.endPointURL()}`),this.unloaded=!1,this.closeWasClean=!1,this.flushSendBuffer(),this.reconnectTimer.reset(),this.resetHeartbeat(),this.stateChangeCallbacks.open.forEach((([,e])=>e()))}resetHeartbeat(){this.conn&&this.conn.skipHeartbeat||(this.pendingHeartbeatRef=null,clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>this.sendHeartbeat()),this.heartbeatIntervalMs))}teardown(e,t,s){if(!this.conn)return e&&e();this.waitForBufferDone((()=>{this.conn&&(t?this.conn.close(t,s||""):this.conn.close()),this.waitForSocketClosed((()=>{this.conn&&(this.conn.onclose=function(){},this.conn=null),e&&e()}))}))}waitForBufferDone(e,t=1){5!==t&&this.conn&&this.conn.bufferedAmount?setTimeout((()=>{this.waitForBufferDone(e,t+1)}),150*t):e()}waitForSocketClosed(e,t=1){5!==t&&this.conn&&this.conn.readyState!==et?setTimeout((()=>{this.waitForSocketClosed(e,t+1)}),150*t):e()}onConnClose(e){this.hasLogger()&&this.log("transport","close",e),this.triggerChanError(),clearInterval(this.heartbeatTimer),this.closeWasClean||this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((([,t])=>t(e)))}onConnError(e){this.hasLogger()&&this.log("transport",e),this.triggerChanError(),this.stateChangeCallbacks.error.forEach((([,t])=>t(e)))}triggerChanError(){this.channels.forEach((e=>{e.isErrored()||e.isLeaving()||e.isClosed()||e.trigger(lt)}))}connectionState(){switch(this.conn&&this.conn.readyState){case Xe:return"connecting";case Qe:return"open";case Ye:return"closing";default:return"closed"}}isConnected(){return"open"===this.connectionState()}remove(e){this.off(e.stateChangeRefs),this.channels=this.channels.filter((t=>t.joinRef()!==e.joinRef()))}off(e){for(let t in this.stateChangeCallbacks)this.stateChangeCallbacks[t]=this.stateChangeCallbacks[t].filter((([t])=>-1===e.indexOf(t)))}channel(e,t={}){let s=new mt(e,t,this);return this.channels.push(s),s}push(e){if(this.hasLogger()){let{topic:t,event:s,payload:n,ref:i,join_ref:o}=e;this.log("push",`${t} ${s} (${o}, ${i})`,n)}this.isConnected()?this.encode(e,(e=>this.conn.send(e))):this.sendBuffer.push((()=>this.encode(e,(e=>this.conn.send(e)))))}makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}sendHeartbeat(){if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.hasLogger()&&this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void this.abnormalClose("heartbeat timeout");this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef})}}abnormalClose(e){this.closeWasClean=!1,this.conn.readyState===Qe&&this.conn.close(1e3,e)}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((e=>e())),this.sendBuffer=[])}onConnMessage(e){this.decode(e.data,(e=>{let{topic:t,event:s,payload:n,ref:i,join_ref:o}=e;i&&i===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.hasLogger()&&this.log("receive",`${n.status||""} ${t} ${s} ${i&&"("+i+")"||""}`,n);for(let e=0;e<this.channels.length;e++){const r=this.channels[e];r.isMember(t,s,n,o)&&r.trigger(s,n,i,o)}for(let t=0;t<this.stateChangeCallbacks.message.length;t++){let[,s]=this.stateChangeCallbacks.message[t];s(e)}}))}leaveOpenTopic(e){let t=this.channels.find((t=>t.topic===e&&(t.isJoined()||t.isJoining())));t&&(this.hasLogger()&&this.log("transport",`leaving duplicate topic "${e}"`),t.leave())}}class bt{constructor(e){this.endPoint=null,this.token=null,this.skipHeartbeat=!0,this.onopen=function(){},this.onerror=function(){},this.onmessage=function(){},this.onclose=function(){},this.pollEndpoint=this.normalizeEndpoint(e),this.readyState=Xe,this.poll()}normalizeEndpoint(e){return e.replace("ws://","http://").replace("wss://","https://").replace(new RegExp("(.*)/"+ft),"$1/"+dt)}endpointURL(){return wt.appendParams(this.pollEndpoint,{token:this.token})}closeAndRetry(){this.close(),this.readyState=Xe}ontimeout(){this.onerror("timeout"),this.closeAndRetry()}poll(){this.readyState!==Qe&&this.readyState!==Xe||wt.request("GET",this.endpointURL(),"application/json",null,this.timeout,this.ontimeout.bind(this),(e=>{if(e){var{status:t,token:s,messages:n}=e;this.token=s}else var t=0;switch(t){case 200:n.forEach((e=>this.onmessage({data:e}))),this.poll();break;case 204:this.poll();break;case 410:this.readyState=Qe,this.onopen(),this.poll();break;case 403:this.onerror(),this.close();break;case 0:case 500:this.onerror(),this.closeAndRetry();break;default:throw new Error(`unhandled poll status ${t}`)}}))}send(e){wt.request("POST",this.endpointURL(),"application/json",e,this.timeout,this.onerror.bind(this,"timeout"),(e=>{e&&200===e.status||(this.onerror(e&&e.status),this.closeAndRetry())}))}close(e,t){this.readyState=et,this.onclose()}}class wt{static request(e,t,s,n,i,o,r){if(Ze.XDomainRequest){let s=new XDomainRequest;this.xdomainRequest(s,e,t,n,i,o,r)}else{let l=new Ze.XMLHttpRequest;this.xhrRequest(l,e,t,s,n,i,o,r)}}static xdomainRequest(e,t,s,n,i,o,r){e.timeout=i,e.open(t,s),e.onload=()=>{let t=this.parseJSON(e.responseText);r&&r(t)},o&&(e.ontimeout=o),e.onprogress=()=>{},e.send(n)}static xhrRequest(e,t,s,n,i,o,r,l){e.open(t,s,!0),e.timeout=o,e.setRequestHeader("Content-Type",n),e.onerror=()=>{l&&l(null)},e.onreadystatechange=()=>{if(e.readyState===this.states.complete&&l){let t=this.parseJSON(e.responseText);l(t)}},r&&(e.ontimeout=r),e.send(i)}static parseJSON(e){if(!e||""===e)return null;try{return JSON.parse(e)}catch(t){return console&&console.log("failed to parse JSON response",e),null}}static serialize(e,t){let s=[];for(var n in e){if(!e.hasOwnProperty(n))continue;let i=t?`${t}[${n}]`:n,o=e[n];"object"==typeof o?s.push(this.serialize(o,i)):s.push(encodeURIComponent(i)+"="+encodeURIComponent(o))}return s.join("&")}static appendParams(e,t){if(0===Object.keys(t).length)return e;let s=e.match(/\?/)?"&":"?";return`${e}${s}${this.serialize(t)}`}}wt.states={complete:4};class kt{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=null,this.tries=0}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}}const Et=(e,t,s)=>{if(null==t)return;const n=new Date;if(n.getTime()-t.getTime()<3e4)return;let i=`https://${apiUrl}/listening_session/`;null!==s&&(i+=s);const o={date_time_start:t.toISOString(),date_time_end:n.toISOString(),source:"seo",ctrl:Math.random()};return e.includes("-")?o.stream_id=e:o.radio_stream_code_name=`${e}_main`,fetch(i,{method:null!==s?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then((e=>e.json())).then((e=>void 0!==e.id?e:null))};Fe({hls:null,socket:null,channel:null,playing:!1,song:null,lastUpdated:null,radioId:null,playingStart:null,sessionId:null,listeningInterval:null,play(e,t,s){let n;if(sendGaEvent("play","SSR",t,3),this.playing=!0,this.radioId=t,this.sessionId=null,this.playerStart=new Date,-1!==e.indexOf(".m3u8"))new Promise(((e,t)=>{if(null!==document.getElementById("hls-script"))return void e();const s=document.createElement("video");s.id="videoplayer",s.style="display:none",document.body.appendChild(s);const n=document.createElement("script");n.type="text/javascript",n.id="hls-script",n.src="/js/hls.js",n.onload=e,n.onerror=t,document.body.appendChild(n)})).then((()=>{Hls.isSupported()&&(window.audio=document.getElementById("videoplayer"),this.hls=new Hls,this.hls.attachMedia(window.audio),this.hls.on(Hls.Events.MEDIA_ATTACHED,(()=>{this.hls.loadSource(e),this.hls.on(Hls.Events.MANIFEST_PARSED,(()=>{n=window.audio.play()}))})))}));else{const t="https"!==e.substring(0,5)?`${streamsProxy}?stream=${e}`:e;window.audio=new Audio(`${t}`),n=window.audio.play()}void 0!==n&&n.then((()=>{window.audio.addEventListener("timeupdate",(()=>{this.lastUpdated=new Date})),this.lastUpdated=new Date,this.playingStart=new Date,this.connectSocket(),this.joinChannel(s),this.listeningInterval=setInterval((()=>{Et(this.radioId,this.playingStart,this.sessionId).then((e=>{null!==e.id&&(this.sessionId=e.id,this.playingStart=new Date(e.date_time_start))}))}),3e4)})).catch((()=>this.stop()))},stop(){void 0!==window.audio&&null!==window.audio&&window.audio.pause(),null!==this.hls&&(this.hls.destroy(),this.hls=null),window.audio=null,delete window.audio,!1!==this.playing&&(Et(this.radioId,this.playingStart,this.sessionId),sendGaEvent("stop","SSR",this.radioId,1)),null!==this.listeningInterval&&clearInterval(this.listeningInterval),this.playing=!1,this.radioId=null,this.listeningInterval=null,this.sessionId=null,this.playingStart=null},connectSocket(){null===this.socket&&(this.socket=new yt(`wss://${apiUrl}/socket`),this.socket.connect(),this.socket.onError((()=>{this.song=null,this.socket=null})))},joinChannel(e){this.channel=this.socket.channel(e,{}),this.channel.join().receive("error",(e=>{this.song=null,this.channel=null})).receive("timeout",(()=>{this.song=null,this.channel=null})),this.channel.on("playing",(e=>{this.formatSong(e)})),this.channel.on("quit",(()=>{this.song=null,this.channel=null}))},formatSong(e){if(console.log(e.song),null===e||void 0===e.song)return void(this.song=null);let t="",s=!1;void 0!==e.song.artist&&null!==e.song.artist&&""!==e.song.artist&&(t+=e.song.artist,s=!0),void 0!==e.song.title&&null!==e.song.title&&""!==e.song.title&&(!0===s&&(t+=" - "),t+=e.song.title),console.log(t),this.song=""===t?null:t}}).mount()})();
{% endverbatim %}
</script>
